<h2 class="text-xl font-semibold text-text">Change password</h2>
<p class="mt-1 text-sm text-text-muted">Update your account password.</p>

<form [formGroup]="form" (ngSubmit)="onSubmit()" class="mt-6 max-w-md space-y-4">
  <!-- Current Password -->
  <mat-form-field appearance="outline" class="w-full">
    <mat-label>Current password</mat-label>
    <input
      matInput
      [type]="showCurrentPassword() ? 'text' : 'password'"
      formControlName="currentPassword"
      autocomplete="current-password"
    />
    <button
      mat-icon-button
      matSuffix
      type="button"
      (click)="toggleCurrentPassword()"
      [attr.aria-label]="showCurrentPassword() ? 'Hide password' : 'Show password'"
    >
      <mat-icon>{{ showCurrentPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
    </button>
    @if (form.controls.currentPassword.hasError('required')) {
      <mat-error>Current password is required.</mat-error>
    }
  </mat-form-field>

  <!-- New Password -->
  <mat-form-field appearance="outline" class="w-full">
    <mat-label>New password</mat-label>
    <input
      matInput
      [type]="showNewPassword() ? 'text' : 'password'"
      formControlName="newPassword"
      autocomplete="new-password"
    />
    <button
      mat-icon-button
      matSuffix
      type="button"
      (click)="toggleNewPassword()"
      [attr.aria-label]="showNewPassword() ? 'Hide password' : 'Show password'"
    >
      <mat-icon>{{ showNewPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
    </button>
    @switch (true) {
      @case (form.controls.newPassword.hasError('required')) {
        <mat-error>New password is required.</mat-error>
      }
      @case (form.controls.newPassword.hasError('minlength')) {
        <mat-error>Password must be at least 8 characters.</mat-error>
      }

      @case (form.controls.newPassword.hasError('server')) {
        <mat-error>{{ form.controls.newPassword.getError('server') }}</mat-error>
      }
    }
  </mat-form-field>

  <!-- Confirm Password -->
  <mat-form-field appearance="outline" class="w-full">
    <mat-label>Confirm new password</mat-label>
    <input
      matInput
      [type]="showConfirmPassword() ? 'text' : 'password'"
      formControlName="confirmPassword"
      autocomplete="new-password"
    />
    <button
      mat-icon-button
      matSuffix
      type="button"
      (click)="toggleConfirmPassword()"
      [attr.aria-label]="showConfirmPassword() ? 'Hide password' : 'Show password'"
    >
      <mat-icon>{{ showConfirmPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
    </button>
    @if (form.controls.confirmPassword.hasError('required')) {
      <mat-error>Please confirm your password.</mat-error>
    } @else if (form.errors?.['passwordsMismatch']) {
      <mat-error>Passwords do not match.</mat-error>
    }
  </mat-form-field>

  <button mat-flat-button type="submit" [disabled]="submitting()" class="w-full">
    @if (submitting()) {
      <mat-spinner diameter="18" class="inline-block mr-2"></mat-spinner>
      Changingâ€¦
    } @else {
      Change password
    }
  </button>
</form>
