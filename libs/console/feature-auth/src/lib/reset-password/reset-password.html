@if (tokenError()) {
<h2 class="text-xl font-semibold text-text">Invalid reset link</h2>
<p class="mt-2 text-sm text-text-muted">
  This password reset link is invalid or has expired. Please request a new one.
</p>
<a mat-flat-button routerLink="/auth/forgot-password" class="mt-6 w-full">
  Request new reset link
</a>
} @else {
<h2 class="text-xl font-semibold text-text">Reset password</h2>
<p class="mt-1 text-sm text-text-muted">Enter your new password below.</p>

<form [formGroup]="form" (ngSubmit)="onSubmit()" class="mt-6 space-y-4">
  <!-- New Password -->
  <mat-form-field appearance="outline" class="w-full">
    <mat-label>New password</mat-label>
    <input
      matInput
      [type]="showPassword() ? 'text' : 'password'"
      formControlName="password"
      autocomplete="new-password"
      placeholder="••••••••"
    />
    <button
      mat-icon-button
      matSuffix
      type="button"
      (click)="togglePassword()"
      [attr.aria-label]="showPassword() ? 'Hide password' : 'Show password'"
    >
      <mat-icon>{{ showPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
    </button>
    @if (form.controls.password.hasError('required')) {
    <mat-error>Password is required.</mat-error>
    } @else if (form.controls.password.hasError('minlength')) {
    <mat-error>Password must be at least 8 characters.</mat-error>
    }
  </mat-form-field>

  <!-- Confirm Password -->
  <mat-form-field appearance="outline" class="w-full">
    <mat-label>Confirm password</mat-label>
    <input
      matInput
      type="password"
      formControlName="confirmPassword"
      autocomplete="new-password"
      placeholder="••••••••"
    />
    @if (form.controls.confirmPassword.hasError('required')) {
    <mat-error>Please confirm your password.</mat-error>
    } @else if (form.errors?.['passwordsMismatch']) {
    <mat-error>Passwords do not match.</mat-error>
    }
  </mat-form-field>

  <button mat-flat-button type="submit" [disabled]="submitting()" class="w-full">
    @if (submitting()) {
    <mat-spinner diameter="18" class="inline-block mr-2"></mat-spinner>
    Resetting… } @else { Reset password }
  </button>
</form>

<p class="mt-4 text-center text-sm text-text-muted">
  <a routerLink="/auth/login" class="text-primary hover:underline">Back to sign in</a>
</p>
}
